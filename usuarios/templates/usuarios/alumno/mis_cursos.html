{% extends "usuarios/alumno/base_alumno.html" %}

{% block content %}
    <h4 class="mb-4 fw-bold">游닄 Mis Cursos Matriculados</h4>

    <div class="card p-3 mb-4 shadow-sm">
        <p class="mb-0"><strong>Alumno:</strong> {{ perfil.nombre }}</p>
    </div>
    
    {% if cursos_info %}
        <div class="table-responsive">
          <table class="table table-striped table-hover align-middle">
                <thead class="table-dark">
                  <tr>
                        <th scope="col">C칩digo</th>
                        <th scope="col">Asignatura</th>
                        <th scope="col">Grupo (Teor칤a)</th>
                        <th scope="col">Docente (Teor칤a)</th>
                        <th scope="col">Grupo (Lab)</th>
                        <th scope="col">Docente (Lab)</th>
                        <th scope="col" class="text-center">Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  {% for curso in cursos_info %}
                        <!-- Fila principal del Curso -->
                        <tr>
                          <td><strong>{{ curso.curso_id }}</strong></td>
                          <td>{{ curso.nombre_curso }}</td>
                          <td><span class="badge bg-primary">{{ curso.grupo_teoria }}</span></td>
                          <td>{{ curso.profesor_teoria }}</td>
                          <td>
                                {% if curso.grupo_lab == 'N/A' %}
                                  <span class="badge bg-danger">N/A</span>
                                {% else %}
                                  <span class="badge bg-success">{{ curso.grupo_lab }}</span>
                                {% endif %}
                          </td>
                          <td>
                                {{ curso.profesor_lab }}
                          </td>
                            <td class="text-center">
                                <div class="d-flex flex-column gap-1 align-items-center">
                                        <!-- Bot칩n Ver Notas -->
                                        <a href="{% url 'usuarios:mis_notas_alumno' %}?curso={{ curso.curso_id }}" class="btn btn-sm btn-info text-white w-100">Ver Notas</a>
                                        
                                        <!-- Bot칩n Asignar Lab (solo si no tiene lab) -->
                                        {% if curso.grupo_lab == 'N/A' %}
                                        <a href="{% url 'usuarios:matricula_lab_alumno' %}" class="btn btn-sm btn-warning w-100">Matricular Lab</a>
                                        {% endif %}
                                        
                                        <!-- Bot칩n Ver S칤labo -->
                                        {% if curso.tiene_silabo %}
                                        <a href="{{ curso.silabo_url }}" class="btn btn-sm btn-success w-100" download>Ver S칤labo</a>
                                        {% else %}
                                        <button class="btn btn-sm btn-secondary w-100" disabled>Sin S칤labo</button>
                                        {% endif %}
                                        
                                        <!-- Bot칩n Ver Temas -->
                                        {% if curso.temas %}
                                        <button class="btn btn-sm btn-dark w-100" type="button" data-bs-toggle="collapse" data-bs-target="#{{ curso.collapse_id }}" aria-expanded="false" aria-controls="{{ curso.collapse_id }}">Ver Temas</button>
                                        {% else %}
                                        <button class="btn btn-sm btn-secondary w-100" disabled>Sin Temas</button>
                                        {% endif %}
                                </div>
                            </td>
                        </tr>

                        <!-- Fila de detalles colapsable (TEMAS) -->
                        <tr class="collapse" id="{{ curso.collapse_id }}">
                          <td colspan="7" class="p-0">
                                <div class="p-4 bg-light">
                                  <h6><i class="bi bi-list-task me-2"></i> Temario de {{ curso.nombre_curso }} (Grupo: {{ curso.grupo_teoria }})</h6>
                                  <ul class="list-group list-group-flush mt-3">
                                        {% for tema in curso.temas %}
                                        <li class="list-group-item d-flex justify-content-between align-items-center">
                                          <!-- N칰mero y Nombre del Tema -->
                                          <span>
                                                <span class="badge bg-secondary me-2">{{ tema.orden }}</span>
                                                {{ tema.nombre }}
                                          </span>
                                          
                                          <!-- Estado de Completado -->
                                          {% if tema.completado %}
                                                <span class="badge bg-success"><i class="bi bi-check-circle-fill"></i> Completado</span>
                                          {% else %}
                                                <span class="badge bg-warning text-dark"><i class="bi bi-clock-fill"></i> Pendiente</span>
                                          {% endif %}
                                        </li>
                                        {% empty %}
                                        <li class="list-group-item text-center text-muted">A칰n no se han registrado temas para este grupo.</li>
                                        {% endfor %}
                                  </ul>
                                </div>
                          </td>
                        </tr>
                    {% endfor %}
                </tbody>
          </table>
        </div>
  {% else %}
        <div class="alert alert-warning text-center mt-5">
          <strong>춰Aviso!</strong> No se encontraron cursos activos matriculados para el ciclo actual.
        </div>
  {% endif %}
{% endblock content %}