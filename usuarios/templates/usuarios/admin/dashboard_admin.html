{% extends "usuarios/admin/base_admin.html" %}

{% block content %}
  <h4 class="mb-4">Panel de Control | Bienvenido(a), <strong>{{ perfil.nombre }}</strong></h4>
  
  <!-- Fila 1: Estadísticas principales -->
  <div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-white bg-success mb-3 shadow-sm">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="card-title mb-1">Profesores Activos</h6>
                    <p class="card-text fs-4 fw-bold mb-0">{{ conteo_profesores }}</p>
                    <small class="opacity-75">{{ profesores_grupos_asignados }} con grupos asignados</small>
                </div>
                <i class="bi bi-person-badge fs-2"></i>
            </div>
            <div class="card-footer bg-success border-0 py-2">
                <a href="{% url 'usuarios:registro_profesores_admin' %}" class="text-white small d-flex align-items-center">
                    <i class="bi bi-arrow-right-circle me-1"></i> Ver profesores
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-white bg-info mb-3 shadow-sm">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="card-title mb-1">Estudiantes Activos</h6>
                    <p class="card-text fs-4 fw-bold mb-0">{{ conteo_estudiantes }}</p>
                    <small class="opacity-75">{{ total_matriculas }} matrículas activas</small>
                </div>
                <i class="bi bi-people fs-2"></i>
            </div>
            <div class="card-footer bg-info border-0 py-2">
                <a href="{% url 'usuarios:registro_estudiantes_admin' %}" class="text-white small d-flex align-items-center">
                    <i class="bi bi-arrow-right-circle me-1"></i> Gestionar estudiantes
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-white bg-warning mb-3 shadow-sm">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="card-title mb-1">Cursos Activos</h6>
                    <p class="card-text fs-4 fw-bold mb-0">{{ conteo_cursos }}</p>
                    <small class="opacity-75">{{ grupos_teoria }}T / {{ grupos_laboratorio }}L</small>
                </div>
                <i class="bi bi-journal-text fs-2"></i>
            </div>
            <div class="card-footer bg-warning border-0 py-2">
                <a href="{% url 'usuarios:gestion_cursos_admin' %}" class="text-white small d-flex align-items-center">
                    <i class="bi bi-arrow-right-circle me-1"></i> Gestionar cursos
                </a>
            </div>
        </div>
    </div>
    
    <div class="col-md-3">
        <div class="card text-white bg-primary mb-3 shadow-sm">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h6 class="card-title mb-1">Aulas Disponibles</h6>
                    <p class="card-text fs-4 fw-bold mb-0">{{ conteo_aulas }}</p>
                    <small class="opacity-75">{{ total_bloques }} horarios asignados</small>
                </div>
                <i class="bi bi-building fs-2"></i>
            </div>
            <div class="card-footer bg-primary border-0 py-2">
                <a href="{% url 'usuarios:ver_horarios_clases_admin' %}" class="text-white small d-flex align-items-center">
                    <i class="bi bi-arrow-right-circle me-1"></i> Ver horarios
                </a>
            </div>
        </div>
    </div>
  </div>
  
  <!-- Fila 2: Estadísticas detalladas -->
  <div class="row mb-4">
    <div class="col-md-6">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h6 class="mb-0 fw-bold">
                    <i class="bi bi-calendar-week me-2"></i> Actividad Reciente
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-6">
                        <div class="d-flex align-items-center mb-3">
                            <div class="bg-primary bg-opacity-10 p-2 rounded me-3">
                                <i class="bi bi-calendar-check text-primary"></i>
                            </div>
                            <div>
                                <small class="text-muted d-block">Reservas esta semana</small>
                                <span class="fw-bold">{{ reservas_semana }}</span>
                            </div>
                        </div>
                        <div class="d-flex align-items-center mb-3">
                            <div class="bg-success bg-opacity-10 p-2 rounded me-3">
                                <i class="bi bi-clipboard-check text-success"></i>
                            </div>
                            <div>
                                <small class="text-muted d-block">Registros de asistencia</small>
                                <span class="fw-bold">{{ asistencia_semana }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="d-flex align-items-center mb-3">
                            <div class="bg-warning bg-opacity-10 p-2 rounded me-3">
                                <i class="bi bi-calendar-day text-warning"></i>
                            </div>
                            <div>
                                <small class="text-muted d-block">Reservas para hoy</small>
                                <span class="fw-bold">{{ reservas_hoy }}</span>
                            </div>
                        </div>
                        <div class="d-flex align-items-center">
                            <div class="bg-info bg-opacity-10 p-2 rounded me-3">
                                <i class="bi bi-check-circle text-info"></i>
                            </div>
                            <div>
                                <small class="text-muted d-block">Asistencia promedio</small>
                                <span class="fw-bold">{{ porcentaje_asistencia }}%</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-3 small text-muted">
                    <i class="bi bi-info-circle me-1"></i> Período: {{ semana_pasada }} al {{ viernes_semana }}
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card shadow-sm">
            <div class="card-header bg-light">
                <h6 class="mb-0 fw-bold">
                    <i class="bi bi-pie-chart me-2"></i> Distribución de Recursos
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-6">
                        <div class="mb-3">
                            <small class="text-muted d-block">Grupos con profesor</small>
                            <div class="progress" style="height: 8px;">
                                <div class="progress-bar bg-success" style="width: {% widthratio grupos_con_profesor grupos_con_profesor|add:grupos_sin_profesor 100 %}%"></div>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <small>{{ grupos_con_profesor }} asignados</small>
                                <small>{{ grupos_sin_profesor }} sin asignar</small>
                            </div>
                        </div>
                        <div class="mb-3">
                            <small class="text-muted d-block">Matrículas por tipo</small>
                            <div class="progress" style="height: 8px;">
                                <div class="progress-bar bg-info" style="width: {% widthratio matriculas_teoria total_matriculas 100 %}%"></div>
                                <div class="progress-bar bg-warning" style="width: {% widthratio matriculas_lab total_matriculas 100 %}%"></div>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <small>{{ matriculas_teoria }} Teoría</small>
                                <small>{{ matriculas_lab }} Laboratorio</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="mb-3">
                            <small class="text-muted d-block">Tipos de grupo</small>
                            <div class="progress" style="height: 8px;">
                                <div class="progress-bar bg-success" style="width: {% widthratio grupos_teoria grupos_teoria|add:grupos_laboratorio 100 %}%"></div>
                                <div class="progress-bar bg-warning" style="width: {% widthratio grupos_laboratorio grupos_teoria|add:grupos_laboratorio 100 %}%"></div>
                            </div>
                            <div class="d-flex justify-content-between mt-1">
                                <small>{{ grupos_teoria }} Teoría</small>
                                <small>{{ grupos_laboratorio }} Laboratorio</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
  </div>
  
  <!-- Fila 3: Top listados -->
  <div class="row mb-4">
    <div class="col-md-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-light">
                <h6 class="mb-0 fw-bold">
                    <i class="bi bi-trophy me-2"></i> Cursos con más matriculados
                </h6>
            </div>
            <div class="card-body p-0">
                {% if top_cursos %}
                <div class="list-group list-group-flush">
                    {% for curso in top_cursos %}
                    <div class="list-group-item border-0 py-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">{{ curso.nombre|truncatechars:30 }}</h6>
                                <small class="text-muted">{{ curso.id }}</small>
                            </div>
                            <span class="badge bg-primary rounded-pill">{{ curso.total_matriculas }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-4 text-muted">
                    <i class="bi bi-journal-x fs-4"></i>
                    <p class="mt-2 mb-0">No hay datos de matrículas</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-light">
                <h6 class="mb-0 fw-bold">
                    <i class="bi bi-building me-2"></i> Aulas más utilizadas
                </h6>
            </div>
            <div class="card-body p-0">
                {% if aulas_populares %}
                <div class="list-group list-group-flush">
                    {% for aula in aulas_populares %}
                    <div class="list-group-item border-0 py-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">Aula {{ aula.id }}</h6>
                                <small class="text-muted">{{ aula.get_tipo_display }}</small>
                            </div>
                            <span class="badge bg-info rounded-pill">{{ aula.total_bloques }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-4 text-muted">
                    <i class="bi bi-building fs-4"></i>
                    <p class="mt-2 mb-0">No hay horarios asignados</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-light">
                <h6 class="mb-0 fw-bold">
                    <i class="bi bi-person-check me-2"></i> Profesores con más grupos (top mas explotados)
            </div>
            <div class="card-body p-0">
                {% if profesores_activos %}
                <div class="list-group list-group-flush">
                    {% for profesor in profesores_activos %}
                    <div class="list-group-item border-0 py-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-1">{{ profesor.perfil.nombre|truncatechars:25 }}</h6>
                                <small class="text-muted">
                                    {% if profesor.es_teoria and profesor.es_lab %}
                                        Teoría/Lab
                                    {% elif profesor.es_teoria %}
                                        Teoría
                                    {% elif profesor.es_lab %}
                                        Laboratorio
                                    {% else %}
                                        Sin especialización
                                    {% endif %}
                                </small>
                            </div>
                            <span class="badge bg-success rounded-pill">{{ profesor.total_grupos }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-4 text-muted">
                    <i class="bi bi-person-x fs-4"></i>
                    <p class="mt-2 mb-0">No hay profesores con grupos</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
  </div>
{% endblock content %}